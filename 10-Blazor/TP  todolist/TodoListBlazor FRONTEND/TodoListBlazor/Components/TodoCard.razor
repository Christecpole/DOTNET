@using TodoListBlazor.Dtos

<div class="card h-100 @(Todo.IsCompleted ? "border-success" : "")">
    
    <div class="card-header d-flex justify-content-between align-items-center">
        <span class="@(Todo.IsCompleted ? "text-decoration-line-through text-muted" : "")">@Todo.Title</span>
        <span class="@Todo.PriorityBadgeClass">@Todo.PriorityName</span>
    </div>

    <div class="card-body">
        @if (!string.IsNullOrEmpty(Todo.Description))
        {
            <p class="card-text text-muted small">@Todo.Description</p>
        }

        @if (Todo.DueDate.HasValue)
        {
            <p class="card-text">
                <small class="@(Todo.IsOverdue ? "text-danger fw-bold" : "text-muted")">
                    @Todo.FormattedDueDate
                    @if (Todo.IsOverdue)
                    {
                        <span>(En retard !)</span>
                    }
                </small>
            </p>
        }
        @if (Todo.IsCompleted)
        {
            <span class="badge badge-success">Terminée</span>
        }
    </div>

    <div class="card-footer bg-transparent">
        <div class="btn-group w-100" role="group">
            <button class="btn btn-sm @(Todo.IsCompleted ? "btn-outline-secondary" : "btn-outline-success")"
                    @onclick="() => OnToggle.InvokeAsync(Todo)"
                    title="@(Todo.IsCompleted ? "Marquer à faire" : "Marquer terminée")">
                @(Todo.IsCompleted ? "À faire" : "Terminer")
            </button>
            <button class="btn btn-sm btn-outline-primary"
                    @onclick="() => OnEdit.InvokeAsync(Todo)"
                    title="Modifier">
                Modifier
            </button>
            <button class="btn btn-sm btn-outline-danger"
                    @onclick="() => OnDelete.InvokeAsync(Todo)"
                    title="Supprimer">
                Supprimer
            </button>
        </div>
    </div>

</div>

@code {
    [Parameter]
    public TodoItem Todo { get; set; } = new();

    //EventCallBacks pour communiquer avec le parent
    [Parameter]
    public EventCallback<TodoItem> OnToggle { get; set; }
    [Parameter]
    public EventCallback<TodoItem> OnEdit { get; set; }
    [Parameter]
    public EventCallback<TodoItem> OnDelete { get; set; }

}
